# 目的
ドゥイットくんのキャラクター画像を表示し、生成されるアクションプランにドゥイットくんの独特な脳筋キャラクター性を反映させることで、ユーザー体験をより魅力的で楽しいものにする。

## 背景
- 現在、`DoitKunArea.tsx`はテキストのみで「ドゥイットくん召喚！」と表示
- アクションプランの生成プロンプト（`src/lib/actions.ts:100-102`）は一般的な文言で、ドゥイットくんの脳筋・行動派キャラクター性が反映されていない
- ドゥイットくんのキャラクター画像（`public/doitkun.webp`）が既に用意されているが未使用
- キャラクター設定が明確に定義されているが、アプリに反映されていない

## ドゥイットくんの設定
**基本情報:**
- 名前: ドゥイットくん
- 年齢: 20代男性
- 職業: 自分のパーソナルトレーナー（ニート）
- 性格: フフッとなる脳筋行動派。考えるより動く。論理が破綻しているが、なぜか説得力がある。

**口調・思考:**
- 一人称/二人称: オレ / 君
- 決め台詞: ドゥーイット！！！
- 口癖: これで解決だな！（※まったく解決していない状況で使う）
- 象徴的なセリフ:
  - 1日1cmずつやれば、そりゃデカくなるでしょ？時間って、無限だからな！
  - 失敗ってのは、筋肉痛みたいなもんだ。成長してる証拠だろ？
  - 考えてみろよ。1回できるなら、10回もできる。10回できるなら100回もできる。つまり無限！
- 計算ロジック: 簡単な算数を極端に拡大解釈し、論理を破綻させる（例：100回やったら1000%成功）

**嗜好・行動:**
- 好きな食べ物: プロテイン（栄養が凝縮されているから）
- 嫌いな食べ物: きゅうり（栄養が無いから）
- 脳筋行動例: 本を燃やして暖を取る
- 畏敬の対象: 社長（最強の象徴。社長と聞くと萎縮する）
- その他行動: 筋肉は共有財産だと信じている

# ゴール
- ドゥイットくんの画像（`public/doitkun.webp`）を`DoitKunArea.tsx`で表示
- アクションプラン生成プロンプトに、ドゥイットくんのキャラクター性（脳筋・行動派・口調）を反映
- 生成されたアクションプランが「オレ / 君」口調で、ドゥイットくんらしい励ましと極端な論理を含むようにする

# データベース関連の変更
なし

# 編集するファイル名
- `src/app/components/DoitKunArea.tsx` - ドゥイットくん画像を表示
- `src/lib/actions.ts` - `generateSmallStepActionPlan()`のプロンプトを変更してキャラクター性を反映

# 新たに導入するライブラリ
なし

# タスク
- [x] `DoitKunArea.tsx`にドゥイットくんの画像（`/doitkun.webp`）を表示する
  - [x] 画像を適切なサイズで表示（96x96px）
  - [x] 画像位置は「ドゥイットくん召喚！」の見出しの近くに配置
- [x] `src/lib/actions.ts`の`generateSmallStepActionPlan()`のプロンプトを変更
  - [x] ドゥイットくんの口調（オレ / 君、ドゥーイット！！！など）を反映
  - [x] キャラクター設定を加味した指示（脳筋・行動派・極端な論理）を追加
  - [x] プロンプトに「1日1cm→時間は無限」「100回→1000%成功」などの例を追加
- [x] 動作確認: 実際にメーターを貯めてアクションプランを生成し、キャラクター性が反映されているか確認
- [x] ユーザーにチェックをもらう(必須)

# 修正タスク
- [x] ドゥイットくん画像を大きく丸いアイコン風に表示（「ドゥイットくん召喚！」の下に中央配置）
  - [x] 画像サイズを160x160pxに変更
  - [x] rounded-fullで丸く、border-4で青い枠線を追加
  - [x] 中央配置とshadow-lgで立体感を追加
- [x] アクションプラン生成時に、提案のタイトルもドゥイットくんに決めてもらう（「提案12」のような数字表記を削除）
  - [x] Geminiプロンプトの返却形式をJSON形式に変更（title, steps, comment）
  - [x] `DoitKunArea.tsx`の型定義を変更
  - [x] 表示部分でplan.titleを表示
- [x] アクションプランの最後に、ドゥイットくんのフフッとなる一言を追加
  - [x] プロンプトにcommentフィールドを追加
  - [x] DoitKunArea.tsxでplan.commentを表示（italic、border-topで区切り）
- [ ] ユーザーにチェックをもらう(必須)

# 修正タスク2
- [x] アクションプラン生成中のローディング表示を改善（わかりやすく）
  - [x] スピナーアニメーション（回転する円）を追加
  - [x] 「ドゥイットくんが考え中...」のメッセージを表示
  - [x] 「小さな一歩を計算してるぞ！」のサブメッセージを追加
- [x] ゆるふわメーターのリセットタイミングを改善（アクションプラン生成開始時に即座にリセット）
  - [x] `resetYurufuwaMeter()`サーバーアクションを新規作成
  - [x] `DoitKunArea.tsx`でアクションプラン生成前に先にメーターをリセット
  - [x] `generateSmallStepActionPlan()`からメーターリセット処理を削除
- [x] 初回ローディング表示の修正
  - [x] `actionPlans.length === 0 && !isLoading`の条件に変更し、ローディング中は召喚画面を表示
- [x] ユーザーにチェックをもらう(必須)

# 実装結果サマリー

## 修正したファイル
- `src/app/components/DoitKunArea.tsx` - 画像表示、ローディングUI、初回表示ロジック
- `src/lib/actions.ts` - プロンプト変更、`resetYurufuwaMeter()`追加

## 特に報告したい内容

### 1. ドゥイットくんのキャラクター性の反映
- Geminiプロンプトに「オレ/君」口調、脳筋ロジック、決め台詞を追加
- アクションプランが`{ title, steps, comment }`の構造に変更
- タイトルと一言をドゥイットくんが考えるように

### 2. UI/UX改善
- ドゥイットくん画像: 160x160px、丸いアイコン風、青い枠線
- ローディング: スピナーアニメーション + メッセージ2行
- メーターリセット: AI生成前に即座にリセット（体感速度向上）

## 処理の流れ
1. ゆるふわメーター >= 1.0 を検知
2. `resetYurufuwaMeter()` でメーターを即座に0にリセット
3. ローディング表示開始（スピナー + メッセージ）
4. `generateSmallStepActionPlan()` でGemini APIを呼び出し
5. タイトル、3つのステップ、一言を含むアクションプランを生成
6. プランを表示（localStorageに保存）
