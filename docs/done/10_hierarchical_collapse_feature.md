# 目的

深堀りツリーの各階層ごとに折りたたみ/展開を可能にし、情報の見やすさを向上させる。

## 背景
- 現在は親ノート全体の折りたたみのみ可能
- 各深堀りレベル（depth 1-5）ごとに個別に折りたたむことができない
- 長い深堀りツリーが見づらく、特定の階層だけを確認したい場合に不便

# ゴール

深堀りの各階層ごとに独立して折りたたみ/展開ができるようにする

# データベース関連の変更

なし

# 編集するファイル名

- `src/app/components/NoteCard.tsx`
- `src/app/components/DeepDiveTree.tsx`

# 新たに導入するライブラリ

なし

# タスク

- [x] NoteCard.tsxのChildNoteCardで子ノートの階層ごとに折りたたみ状態を管理
- [x] NoteCard.tsxの各階層に折りたたみボタンを追加
- [x] DeepDiveTree.tsxのQAItemで子ノートの階層ごとに折りたたみ状態を管理
- [x] DeepDiveTree.tsxの各階層に折りたたみボタンを追加
- [x] 親ノートの折りたたみと子ノートの階層ごとの折りたたみを区別
- [x] ユーザーにチェックをもらう(必須)

# 修正したファイル

- `src/app/components/NoteCard.tsx`
- `src/app/components/DeepDiveTree.tsx`

# 特に報告したい内容

- ノート一覧画面（NoteCard）とドゥイットくんエリア（DeepDiveTree）の両方に階層ごとの折りたたみ機能を実装
- 各階層が独立した`isExpanded`状態を持ち、個別に折りたたみ可能
- 親ノートの「深堀り」ボタンとは独立して動作
- 進捗バーの下に色付きの折りたたみボタンを配置（ツリーの色に合わせた配色）

# 処理の流れ

1. **親ノートの折りたたみ**: 親ノートの「深堀り」ボタン → 全ての子ノートツリーを一括で表示/非表示
2. **階層ごとの折りたたみ**: 各階層の「次の深堀りを表示/隠す」ボタン → その階層の直下の子ノートのみを個別に表示/非表示
3. **状態管理**: 各`ChildNoteCard`/`QAItem`が独自の`isExpanded`状態を保持
4. **再帰的表示**: 子ノートがさらに子ノートを持つ場合も、同様の折りたたみ機能が再帰的に提供される
