# 目的
現在、ノート作成後にゆるふわメーターが先に更新され、その後ノートのゆるふわスコアが表示される問題がある。これにより、ユーザー体験が不自然になっている。ノートのスコア計算とメーター更新を同期させ、同時に表示されるようにする。

## 背景
- 現在の実装では、ノート作成後に`/api/update-score`を非同期で呼び出している
- SWRのポーリング（5秒）により、メーターとスコアの更新タイミングがずれる
- ユーザーから見ると、メーターだけが先に増えて、スコアが後から表示される不自然な動きになっている

# ゴール
- ノートのゆるふわスコアとユーザーのゆるふわメーターが同時に更新されて表示される
- スコア計算中は適切なローディング表示を行う
- ユーザー体験を自然で一貫性のあるものにする

# データベース関連の変更
なし

# 編集するファイル名
- `src/app/components/NotesPage.tsx` - ノート作成後の処理フローを変更
- `src/app/components/NoteCard.tsx` - スコア計算中のローディング表示を追加
- `src/lib/actions.ts` - スコア計算を同期的に行うオプションを追加、またはレスポンスを改善
- `src/app/api/update-score/route.ts` - 必要に応じて修正

# 新たに導入するライブラリ
なし

# タスク
- [x] 現在の非同期スコア計算フローを分析
- [x] スコア計算とメーター更新を同期的に行う方法を検討（オプション2: update-score APIの完了を待つ）
- [x] `NotesPage.tsx`のノート作成処理を修正（スコア計算完了まで待機）
- [x] NoteCardは既存のスケルトン実装を維持（スコアがnullの場合）
- [x] ゆるふわメーターはスケルトンなしで常に現在値を表示
- [x] SWRのOptimistic Updateを調整（スコアがnullの状態を適切に処理）
- [x] 動作確認: ノート作成→スコアとメーターが同時に更新されることを確認
- [x] ユーザーにチェックをもらう(必須)

# 実装内容
1. `/api/update-score`を同期レスポンスに変更（`await updateScore()`して200を返す）
2. `NotesPage.tsx`で`await fetch('/api/update-score')`してスコア計算完了を待機
3. スコア計算完了後に`mutate()`でSWRを再検証
4. ゆるふわメーターは常に現在値を表示（スケルトンなし）
5. NoteCardは既存のスケルトン実装を維持（`yurufuwaScore === null`の場合）

# 処理の流れ
1. ユーザーがノートを作成
2. Optimistic Updateで即座にノートリストに追加（スコアは`null`、NoteCardでスケルトン表示）
3. `createNote()`でノートをDBに保存
4. `/api/update-score`でGemini APIを使ってスコア計算（同期的に完了を待つ）
5. スコア計算完了後、`mutate()`でSWRを再検証
6. ノートのスコアとユーザーのメーターが同時に更新される
7. エディターがクリアされる
